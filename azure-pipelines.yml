trigger:
- master

#pool:
#  vmImage: 'ubuntu-latest'
pool:
  name: Local Agent

variables:
  OPENSHIFT_URL: 'https://api.rm2.thpm.p1.openshiftapps.com:6443'   # Reemplaza con tu URL real
  OPENSHIFT_TOKEN: '$(OPENSHIFT_TOKEN)'          # Configura como variable secreta
  OPENSHIFT_NAMESPACE: 'jcalvo-dev'                 # Cambia si usas otro namespace

steps:

# Login a OpenShift
- script: |
    oc login $(OPENSHIFT_URL) --token=$(OPENSHIFT_TOKEN) --insecure-skip-tls-verify
    oc project $(OPENSHIFT_NAMESPACE)
  displayName: 'Login en OpenShift'

# Crear nueva app desde GitHub
- script: |
    oc new-app https://github.com/rcarneironet/nodejs-ex -l name=vssummit-app
  displayName: 'Crear nueva app en OpenShift'

# Iniciar build manual
- script: |
    oc start-build nodejs-ex --follow
  displayName: 'Iniciar build'

# Publicar la ruta
- script: |
    oc expose svc nodejs-ex
  displayName: 'Exponer el servicio a Internet'


# Ver estado de la app
- script: |
    oc status
  displayName: 'Ver estado del despliegue'
